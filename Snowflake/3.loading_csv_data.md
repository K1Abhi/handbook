> **Note:** Querying **file metadata** in a stage does **not require a warehouse**, but querying **table data** in Snowflake **does require a warehouse**.

## üì• Loading CSV into Snowflake ‚ùÑÔ∏è

CSV files from your local system can be uploaded to Snowflake by first loading them into a **stage**.

### üóÇÔ∏è Types of Stages

1. **Internal Stages**:
   - **Named Stage**: Created explicitly by the user (`CREATE STAGE mystage`)
   - **User Stage**: Automatically created for each Snowflake user
   - **Table Stage**: Associated with each table

2. **External Stages**:
   - Integration with cloud storage like **AWS S3**, **Google Cloud Storage**, or **Azure Blob Storage**

---

### üì¶ Example: Using an Internal Stage

```sql
-- Create a named internal stage
CREATE STAGE mystage;

-- List files uploaded to the stage
LIST @mystage;

we can query the contents and metadata of a staged file directly
```sql
SELECT metadata$file_row_number, $1, $2
FROM @mystage/emp.csv;
```

### üßæ What This Query Does

- **`@mystage/emp.csv`**  
  Refers to the `emp.csv` file stored in the `mystage` stage. The `@` symbol indicates a reference to a stage.

- **`$1`, `$2`**  
  Positional column references used when querying structured files like CSVs without a defined schema:  
  - `$1` = First column in the file  
  - `$2` = Second column in the file

- **`metadata$file_row_number`**  
  A special Snowflake **metadata column** that returns the **row number** of the current record in the file. Useful for debugging or auditing file contents.

---

### üì§ Query Output

The query will return:
1. The **row number** from the CSV file  
2. The **first column** value  
3. The **second column** value

### üß† Inferring Schema from a CSV File in Snowflake
Snowflake allows you to automatically infer the schema of a file in a stage using the `INFER_SCHEMA` table function.

---
### üìù Step 1: Create a File Format

```sql
CREATE FILE FORMAT myfileformat
    TYPE = 'CSV'
    PARSE_HEADER = TRUE;
```
- `TYPE = 'CSV'`: Specifies the format type.
- `PARSE_HEADER = TRUE`: Indicates the file has a header row.

### üìä Step 2: Infer Schema from the File

### ‚úÖ Syntax Example
```sql
SELECT * 
FROM TABLE(INFER_SCHEMA(
    LOCATION => '@mystage',
    FILES => 'emp.csv',
    FILE_FORMAT => 'myfileformat'
));
```
### ‚ùì Why Use `* FROM TABLE(...)` with `INFER_SCHEMA` in Snowflake?

In Snowflake, when using `INFER_SCHEMA`, you must wrap it inside `TABLE(...)` because it's a **table function**, not a scalar or regular function.

---

### üß† What is a Table Function?

A **table function** returns tabular data ‚Äî that is, rows and columns ‚Äî just like a table.  
In order to query from it, you must use the `TABLE()` keyword in SQL.

---
