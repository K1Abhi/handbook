## 1. âœ… User Defined Functions (UDFs)

### ðŸ”¹ SQL UDF

SQL UDFs are user-defined functions written in standard SQL. They can accept one or more arguments and return a single value.

####  Example: Return Day of the Week in the Future

```sql
CREATE OR REPLACE FUNCTION DAY_NAME_ON(num_of_days INT)
RETURNS STRING
AS
$$
  SELECT 'In ' || CAST(num_of_days AS STRING) || ' days it will be a ' || DAYNAME(DATEADD(DAY, num_of_days, CURRENT_DATE()))
$$;

-- Usuage 
SELECT DAY_NAME_ON(100);
```
> Returns a string like: `"In 100 days it will be a Tuesday"`.

#### JavaScript UDF
JavaScript UDFs allow for greater flexibility, using constructs like arrays, conditions, and loops. \
**Example: JavaScript UDF (full weekday name)**
```sql
CREATE OR REPLACE FUNCTION JS_DAY_NAME_ON(num_of_days FLOAT)
RETURNS STRING
LANGUAGE JAVASCRIPT
AS
$$
  const weekday = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
  const date = new Date();
  date.setDate(date.getDate() + NUM_OF_DAYS);
  let day = weekday[date.getDay()];
  return 'In ' + NUM_OF_DAYS + ' days it will be a ' + day;
$$;

-- Usage
SELECT JS_DAY_NAME_ON(100);
```

#### Overloaded JavaScript UDF
You can create multiple functions with the same name but different parameter signatures (overloading). \
**Example: Abbreviated vs Full Weekday**
```sql
CREATE OR REPLACE FUNCTION JS_DAY_NAME_ON(num_of_days FLOAT, is_abbr BOOLEAN)
RETURNS STRING
LANGUAGE JAVASCRIPT
AS
$$
  let weekday = IS_ABBR === 1
    ? ["Sun", "Mon", "Tues", "Wed", "Thu", "Fri", "Sat"]
    : ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];

  const date = new Date();
  date.setDate(date.getDate() + NUM_OF_DAYS);
  let day = weekday[date.getDay()];
  return 'In ' + NUM_OF_DAYS + ' days it will be a ' + day;
$$;


-- Usage
SELECT JS_DAY_NAME_ON(100, TRUE);  -- Abbreviated
SELECT JS_DAY_NAME_ON(100, FALSE); -- Full
```

## External Functions
External Functions allow Snowflake to invoke external APIs via a proxy integration like AWS API Gateway. \
**Key Components:**
- `API_INTEGRATION`: An object in Snowflake to store AWS/GCP credentials and access configuration.
- `EXTERNAL FUNCTION`: The function declaration calling the external service via URL.

```sql
CREATE OR REPLACE API INTEGRATION demonstration_external_api_integration_01
  API_PROVIDER = aws_api_gateway
  API_AWS_ROLE_ARN = 'arn:aws:iam::123456789012:role/my_cloud_account_role'
  API_ALLOWED_PREFIXES = ('https://xyz.execute-api.us-west-2.amazonaws.com/production')
  ENABLED = true;

CREATE OR REPLACE EXTERNAL FUNCTION local_echo(string_col VARCHAR)
  RETURNS VARIANT
  API_INTEGRATION = demonstration_external_api_integration_01
  AS 'https://xyz.execute-api.us-west-2.amazonaws.com/production/remote_echo';

-- Usage
SELECT local_echo('Hello from Snowflake');
```


